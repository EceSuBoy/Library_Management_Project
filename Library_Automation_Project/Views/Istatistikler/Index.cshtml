
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


<body>
    <div class="page-content fade-in-up">
        <div class="row">
            <div class="col-lg-3 col-md-6">
                <div class="ibox bg-success color-white widget-stat">
                    <div class="ibox-body">
                        <h2 class="m-b-5 font-strong">@ViewBag.GirisSayisi</h2>
                        <div class="m-b-5"></div>the Most Logged in User<i class="ti-user widget-stat-icon"></i>
                        <div><i class="fa fa-level m-r-5"></i><small>@ViewBag.kullaniciAdi</small></div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="ibox bg-info color-white widget-stat">
                    <div class="ibox-body">
                        <h2 class="m-b-5 font-strong">@ViewBag.EnCokSayi</h2>
                        <div class="m-b-5">Member Who Reads the Most</div><i class="fa fa-address-book widget-stat-icon"></i>
                        <div><i class="fa fa-level m-r-5"></i><small>@ViewBag.EnCokUye</small></div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="ibox bg-warning color-white widget-stat">
                    <div class="ibox-body">
                        <h2 class="m-b-5 font-strong">@ViewBag.EnAzSayi</h2>
                        <div class="m-b-5">Member Who Reads the Least</div><i class="fa fa-book widget-stat-icon"></i>
                        <div><i class="fa fa-level m-r-5"></i><small>@ViewBag.EnAzUye</small></div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="ibox bg-danger color-white widget-stat">
                    <div class="ibox-body">
                        <h2 class="m-b-5 font-strong">@ViewBag.Count</h2>
                        <div class="m-b-5">Total Users</div><i class="fa fa-user-circle widget-stat-icon"></i>
                        <div><i class="fa fa-level m-r-5"></i><small></small></div>
                    </div>
                </div>
            </div>

            <div class="col-lg-3 col-md-6">
                <div class="ibox bg-primary color-white widget-stat">
                    <div class="ibox-body">
                        <h2 class="m-b-5 font-strong">@ViewBag.KitapTuruSayisi</h2>
                        <div class="m-b-5">Total Book Categories</div><i class="fa fa-tags widget-stat-icon"></i>
                        <div><i class="fa fa-level m-r-5"></i><small></small></div>

                    </div>
                </div>
            </div>

            <div class="col-lg-3 col-md-6">
                <div class="ibox bg-info color-white widget-stat">
                    <div class="ibox-body">
                        <h2 class="m-b-5 font-strong">@ViewBag.EnFazlaStokKitap.StokAdedi</h2>
                        <div class="m-b-5">Most In-Stock Book</div><i class="fa fa-bookmark widget-stat-icon"></i>
                        <div><small>@ViewBag.EnFazlaStokKitap.KitapAdi</small></div>
                    </div>
                </div>
            </div>

            <div class="col-lg-3 col-md-6">
                <div class="ibox bg-warning color-white widget-stat">
                    <div class="ibox-body">
                        <h2 class="m-b-5 font-strong">@ViewBag.EnAzStokKitap.StokAdedi</h2>
                        <div class="m-b-5">Least In-Stock Book</div><i class="fa fa-warning widget-stat-icon"></i>
                        <div><small>@ViewBag.EnAzStokKitap.KitapAdi</small></div>
                    </div>
                </div>
            </div>

            <div class="col-lg-3 col-md-6">
                <div class="ibox bg-danger color-white widget-stat">
                    <div class="ibox-body">
                        <h2 class="m-b-5 font-strong">@ViewBag.UyeCount</h2>
                        <div class="m-b-5">Total Members</div><i class="fa fa-user-circle-o widget-stat-icon"></i>
                        <div><i class="fa fa-level m-r-5"></i><small></small></div>
                    </div>
                </div>
            </div>

        </div>

   


        <div class="row">
            <div class="col-lg-8">
                <div class="ibox">
                    <div class="ibox-body">
                        <div class="flexbox mb-4">
                            <div>
                                <h3 class="m-0">Statistics</h3>
                                <div>Analysis</div>
                            </div>
                            <div class="d-inline-flex">
                                <div class="px-3" style="border-right: 1px solid rgba(0,0,0,.1);">
                                    <div class="text-muted">Total Number of Entries</div>
                                    <div>
                                        <span class="h2 m-0">@ViewBag.ToplamKHGSayisi</span>
                                        <span class="text-success ml-2"><i class="fa fa-level"></i> </span>
                                    </div>
                                </div>
                                <div class="px-3">
                                    <div class="text-muted">Number of Entries in 6 Months</div>
                                    <div>
                                        <span class="h2 m-0">@ViewBag.AltiAyToplamKHGSayisi</span>
                                        <span class="text-warning ml-2"><i class="fa fa-level"></i></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <canvas id="grafikHareket" style="height:260px;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="ibox">
                    <div class="ibox-head">
                        <div class="ibox-title">Top 3 Members Who Reads the Most</div>
                    </div>
                    <div class="ibox-body">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <canvas id="dairesel_grafik" style="height:220px;"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-5">
            <div class="col-md-6">
                <h4>The Latest Added Book</h4>
                @if (ViewBag.LatestBook != null)
                {
                    var latest = ViewBag.LatestBook;
                    <div class="card shadow-sm" style="width: 100%;">
                        <img src="@latest.KapakResmi" class="card-img-top" style="height: 300px; object-fit: cover;" alt="Kapak Resmi">
                        <div class="card-body">
                            <h5 class="card-title">@latest.KitapAdi</h5>
                            <p class="card-text text-muted">Yazar: @latest.Yazari</p>
                        </div>
                    </div>
                }
            </div>

            <div class="col-md-6">
                <h4>The Most Read Book</h4>
                <div class="d-flex flex-wrap gap-3">
                    @foreach (var kitap in ViewBag.TopBooks)
                    {
                        <div class="card shadow-sm" style="width: 100%;">
                            <img src="@kitap.KapakResmi" class="card-img-top" style="height: 300px; object-fit: cover;" alt="Kapak Resmi">
                            <div class="card-body p-2 text-center">
                                <h6 class="card-title mb-0">@kitap.KitapAdi</h6>
                                <p class="card-text text-muted">Yazar: @kitap.Yazari</p>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>


        <script>
    $(document).ready(function () {
        // ✅ PIE CHART - Top 3 Readers
        var uyeKitap = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.UyeKitapModel));

        var labelsPie = uyeKitap.map(x => `${x.AdiSoyadi} (${x.Yuzde.toFixed(2)}%)`);
        var dataPie = uyeKitap.map(x => x.OkunanKitapSayisi);

        var pieCtx = document.getElementById('dairesel_grafik').getContext('2d');
        new Chart(pieCtx, {
            type: 'pie',
            data: {
                labels: labelsPie,
                datasets: [{
                    data: dataPie,
                    backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56'],
                    borderColor: '#fff',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function (context) {
                                return `${context.label}: ${context.parsed} books`;
                            }
                        }
                    },
                    legend: {
                        labels: {
                            font: {
                                size: 12
                            }
                        }
                    }
                }
            }
        });

        // ✅ LINE CHART - Last 6 Months
        var aylikVeri = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.AylikVeriler));

        var labelsLine = aylikVeri.map(data => `${data.Ay}/${data.Yil}`);
        var dataLine = aylikVeri.map(data => data.HareketSayi); // dikkat: HareketSayi büyük H

        var lineCtx = document.getElementById('grafikHareket').getContext('2d');
        new Chart(lineCtx, {
            type: 'line',
            data: {
                labels: labelsLine,
                datasets: [{
                    label: 'User Entries',
                    data: dataLine,
                    fill: true,
                    backgroundColor: 'rgba(54,162,235,0.2)',
                    borderColor: 'rgba(54,162,235,1)',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    });
        </script>



        <style>
            .visitors-table tbody tr td:last-child {
                display: flex;
                align-items: center;
            }

            .visitors-table .progress {
                flex: 1;
            }

            .visitors-table .progress-parcent {
                text-align: right;
                margin-left: 10px;
            }
        </style>
    </div>
</body>


