
<!-- Chatbot HTML -->
<style>
    .chatbot-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: #6c5ce7;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 28px;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        transition: transform 0.3s ease;
        z-index: 1000;
    }
    .chatbot-btn:hover {
        transform: scale(1.1);
    }

    .chatbot-container {
        position: fixed;
        bottom: 100px;
        right: 20px;
        width: 350px;
        max-height: 500px;
        background: white;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        overflow: hidden;
        display: none;
        flex-direction: column;
        animation: fadeIn 0.5s ease-in-out;
        z-index: 1000;
    }

    @@keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .chatbot-header {
        background-color: #6c5ce7;
        color: white;
        padding: 15px;
        font-size: 18px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .chatbot-messages {
        flex: 1;
        padding: 10px;
        overflow-y: auto;
    }

    .chatbot-input {
        display: flex;
        padding: 10px;
        border-top: 1px solid #ddd;
    }

    .chatbot-input input {
        flex: 1;
        padding: 10px;
        border: none;
        outline: none;
        border-radius: 10px;
        background: #f1f1f1;
    }

    .chatbot-input button {
        background: #6c5ce7;
        border: none;
        color: white;
        padding: 10px 15px;
        margin-left: 5px;
        border-radius: 10px;
        cursor: pointer;
        transition: 0.3s;
    }
    .chatbot-input button:hover {
        background: #5b4cd1;
    }

    .chat-message {
        margin-bottom: 10px;
    }
    .user-message {
        text-align: right;
        color: #333;
    }
    .bot-message {
        text-align: left;
        color: #6c5ce7;
    }
</style>

<div class="chatbot-btn" onclick="toggleChatbot()">
    💬
</div>

<div class="chatbot-container" id="chatbot">
    <div class="chatbot-header">
        📚 Smart Library Bot
        <span style="cursor: pointer;" onclick="toggleChatbot()">✖</span>
    </div>
    <div class="chatbot-messages" id="chatMessages"></div>
    <div class="chatbot-input">
        <input type="text" id="chatInput" placeholder="Type your request...">
        <button onclick="sendChat()">Send</button>
    </div>
</div>

<script>
    function toggleChatbot() {
        const bot = document.getElementById("chatbot");
        bot.style.display = bot.style.display === "flex" ? "none" : "flex";
    }

    function appendMessage(msg, isUser) {
        const div = document.createElement("div");
        div.classList.add("chat-message");
        div.classList.add(isUser ? "user-message" : "bot-message");
        div.innerHTML = msg;
        document.getElementById("chatMessages").appendChild(div);
        div.scrollIntoView();
    }

    function sendChat() {
        const input = document.getElementById("chatInput");
        const query = input.value.trim();
        if (!query) return;
        appendMessage(query, true);
        input.value = "";

        fetch("/Books/SearchBook", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ query })
        })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    if (Array.isArray(data.books)) {
                        let list = data.books.map(book => `<div><a href='/Books/Detail/${book.id}'>${book.title}</a></div>`).join('');
                        appendMessage(`Found multiple books:<br>${list}`, false);
                    } else {
                        appendMessage(`Found <a href='/Books/Detail/${data.bookId}'>${data.bookTitle}</a>`, false);
                    }
                } else {
                    appendMessage(data.message, false);
                }
            });
    }
</script>


